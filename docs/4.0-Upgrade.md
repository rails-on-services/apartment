# Changes to `apartment.rb`

This document outlines the changes made to the `apartment.rb` file, focusing on renamed, changed, and newly introduced configuration options.

---

## Renamed Options

| **Old Name**              | **New Name**               | **Notes**                                                              |
|---------------------------|----------------------------|------------------------------------------------------------------------|
| `pg_exclude_clone_tables` | `exclude_tables_from_clone` | Renamed for clarity to better describe the behavior. Update references. |
| `pg_excluded_names`       | `excluded_names`           | Simplified the name for consistency with other options. Update references. |

---

## Options with Changed Defaults

| **Option**                 | **Old Default**                   | **New Default**        | **Notes**                                                                 |
|----------------------------|------------------------------------|------------------------|--------------------------------------------------------------------------|
| `db_migrate_tenants`        | Dynamically `@db_migrate_tenants \|\| true` | Explicitly `true`     | No behavioral change unless dynamic calculation had unintended effects. |
| `persistent_schemas`        | Dynamically `@persistent_schemas \|\| []`   | Explicitly `[]`       | No behavioral change unless dynamic calculation had unintended effects. |
| `parallel_migration_threads`| Dynamically `@parallel_migration_threads \|\| 0` | Explicitly `nil` | Code relying on `0` as default should now handle `nil`.              |

---

## Newly Introduced Options

| **Option**                  | **Description**                                                                 | **Default** |
|-----------------------------|---------------------------------------------------------------------------------|------------|
| `skip_create_schema`         | Prevents `create_schema` statements from appearing in `schema.rb`.             | `true`     |
| `enforce_search_path_reset`  | Controls whether the `search_path` is reset at the end of `switch`.            | `false`    |

---

## Options with Modified Behavior

| **Option**               | **Old Behavior**                                                           | **New Behavior**                                                                                        | **Notes**                                                                                                                               |
|--------------------------|---------------------------------------------------------------------------|--------------------------------------------------------------------------------------------------------|----------------------------------------------------------------------------------------------------------------------------------------|
| `database_schema_file`    | Dynamically set using `Rails.root` and instance variable.                 | Defined via `config_accessor` with dynamic default (`Rails.root.join('db/schema.rb')` if defined).     | Behavior remains consistent, but implementation is cleaner.                                                                          |
| `seed_data_file`          | Dynamically set using `Rails.root` and instance variable.                 | Defined via `config_accessor` with dynamic default (`Rails.root.join('db/seeds.rb')` if defined).      | Behavior remains consistent, but implementation is cleaner.                                                                          |

---

## Summary of Changes

### Refactored to use `ActiveSupport::Configurable`:
- Instead of using instance variables in the module singleton, configuration options are now managed with `config_accessor`.

### Renamed Options:
- `pg_exclude_clone_tables` → `exclude_tables_from_clone`
- `pg_excluded_names` → `excluded_names`

### Changed Defaults:
- `db_migrate_tenants`: Now explicitly defaults to `true`.
- `persistent_schemas`: Now explicitly defaults to `[]`.
- `parallel_migration_threads`: Now explicitly defaults to `nil`.

### New Options:
- `skip_create_schema`
- `enforce_search_path_reset`

### Refactored Options:
- `database_schema_file` and `seed_data_file`: Now implemented with `config_accessor` for cleaner handling of dynamic defaults.

---

## Actions for Consumers

1. **Update Renamed Options**:
   - Replace references to `pg_exclude_clone_tables` with `exclude_tables_from_clone`.
   - Replace references to `pg_excluded_names` with `excluded_names`.

2. **Handle Changed Defaults**:
   - Check for reliance on old dynamic defaults (`db_migrate_tenants`, `persistent_schemas`, `parallel_migration_threads`) and update as needed.

3. **Evaluate New Options**:
   - Configure `skip_create_schema` and `enforce_search_path_reset` based on your application’s requirements.

This refactor streamlines configuration management while introducing new functionality and clearer naming conventions.